<project name="YaCy" default="all" basedir=".">
	<description>
		YaCy - a Peer to Peer search Engine
	</description>
	
<!-- defining all needed directory names -->	
<property name="src" location="source"/>
<property name="lib" location="lib"/>
<property name="libx" location="libx"/>
<property name="build" location="classes"/>
<property name="htroot" location="htroot"/>
<property name="release" location="RELEASE"/>	

<!-- defining some compiler arguments -->
<property name="javacSource" value="1.4"/>	
<property name="javacTarget" value="1.4"/>	
	
<target name="init">
	<tstamp/>
	<mkdir dir="${build}/de/anomic/data"/>
	<mkdir dir="${build}/de/anomic/htmlFilter"/>
	<mkdir dir="${build}/de/anomic/http"/>
	<mkdir dir="${build}/de/anomic/kelondro"/>
	<mkdir dir="${build}/de/anomic/net"/>
	<mkdir dir="${build}/de/anomic/plasma"/>
	<mkdir dir="${build}/de/anomic/plasma/parser"/>
	<mkdir dir="${build}/de/anomic/server"/>
	<mkdir dir="${build}/de/anomic/tools"/>
	<mkdir dir="${build}/de/anomic/yacy"/>
	<mkdir dir="${release}"/>
	
	
	<move file="${src}/yacy.java" tofile="${src}/yacy.java.orig" />
	<tstamp>
		<format property="REPL_DATE_FORMAT" pattern="yyyymmdd" />
	</tstamp>
	
	<filter token="REPL_VERSION" value="0.37" />
	<filter token="REPL_DATE" value="${DSTAMP}"/>
	<copy file="${src}/yacy.java.orig" tofile="${src}/yacy.java" filtering="true" />
</target>


<target name="compile" depends="init" description="compiles the source">
	<javac srcdir="${src}/" destdir="${build}" excludes="de/anomic/plasma/parser/*/*" source="${javacSource}" target="${javacTarget}">
        <classpath>
          	<pathelement location="${build}" />
        	
        	<!-- libs needed for the yacy thread/object-pools -->
          	<pathelement location="${lib}/commons-collections.jar" />
        	<pathelement location="${lib}/commons-pool-1.2.jar" />        	      	
        </classpath>		
	</javac>	
	<javac srcdir="${htroot}/" destdir="${htroot}" classpath="${build}" source="1.4" target="1.4"/>
	<javac srcdir="${htroot}/htdocsdefault" destdir="${htroot}/htdocsdefault" classpath="${build}" source="1.4" target="1.4"/>	
	<javac srcdir="${htroot}/yacy" destdir="${htroot}/yacy" classpath="${build}" source="1.4" target="1.4"/>	
</target>


<target name="all" depends="compile">
	<delete file="${src}/yacy.java" />
	<move file="${src}/yacy.java.orig" tofile="${src}/yacy.java" />
</target>
	
<target name="parsers" depends="compile" description="Compiling and zipping all additional parsers">
    <subant target="">
    	<property name="src" location="${src}"/>
    	<property name="build" location="${build}"/>
    	<property name="libx" location="${libx}"/>
    	<property name="release" location="${release}"/>
    	<property name="javacSource" value="${javacSource}"/>
    	<property name="javacTarget" value="${javacTarget}"/>
		<fileset dir="${src}/" includes="de/anomic/plasma/parser/*/build.xml"/>    	
    </subant>	
</target>	
	
<target name="dist" depends="all,parsers"/>	

<target name="clean" description="make clean">	
    <delete>
      	<fileset dir="${build}" includes="**/*.class" />
    	<fileset dir="${htroot}" includes="**/*.class" />
    </delete>	
</target>
	
</project>
