<script type="text/javascript">
   //<![CDATA[
	$(document).ready(function() {
		$("#side1").accordion("activate", 0);
		// $("#side2").accordion("activate", 1);
		// $('#yoptions').resetForm();
		
		$.ajax({
			type: "POST",
			async: true,
			url: "/xml/bookmarks/xbel/xbel.xml?tag="+qtag,			
			dataType: "xml",
			success: function(xml) {
				$(xml).find('bookmark').each(function(){
					var link = $(this).attr('href');
					var hash = $(this).attr('id');
					var title = $(this).find('title').text();
					var date = $(this).attr('added');
					var desc = $(this).find('desc').text();
					var pub = $(this).find('metadata[owner=YaCy][public]').attr('public');										
					var tags = $(this).find('metadata[owner=Mozilla][ShortcutURL]').attr('ShortcutURL');
					if (tags != undefined) {
						tags = tags.replace(",",", ","g");
					} else {
						tags ="";
					}					
					if (pub == "true") {
						icon = '<img src="img-2/world2.png" alt="public" title="public bookmark"/>'
					} else {
						 var icon = '<img src="img-2/lock.png" alt="private" title="private bookmark"/>'
					}				
					$('<tr></tr')
						.html('<td>' +hash+ '</td><td>' +icon+ '</td><td><h3 class="linktitle">' +HTMLenc(title)+ '</h3><p class="desc">' +HTMLenc(desc)+ '</p><p class="url"><a href="' +link+ '">' +link+ '</a></p><td class="tags">' +HTMLenc(tags)+ ' </td><td class="date">' +date+ '</td>')						
						.appendTo('#ymarks tbody');					
				}); //close each(
				var height=document.documentElement.clientHeight - 205;    			
    			$('#ymarks').flexigrid({
    				colModel: [
						{display: 'Hash', name : 'hash', width : 50, sortable : false, align: 'center', hide: true},
						{display: '', name : 'public', width : 25, sortable : true, align: 'center'},
						{display: 'Title', name : 'title', width : 450, sortable : true, align: 'left'},
						{display: 'Tags', name : 'tags', width : 240, sortable : false, align: 'left'},
						{display: 'Date', name : 'date', width : 130, sortable : true, align: 'left'}
					],
					buttons: [
						{name: 'Crawl', bclass: 'crawl', onpress: bm_action},
						{separator: true},
						{name: 'Bookmark', bclass: 'bookmark', onpress: bm_action},
						{separator: true},
						{name: 'Edit', bclass: 'edit', onpress: bm_action},
						{name: 'Delete', bclass: 'delete', onpress: bm_action},
						{separator: true},
						{name: 'RSS', bclass: 'rss', onpress: bm_action},
						{name: 'XBEL', bclass: 'xml', onpress: bm_action},
						{name: 'XML', bclass: 'xml', onpress: bm_action},
						{separator: true},
						{name: 'Import', bclass: 'import', onpress: bm_action},
						{separator: true},
						{name: 'Help', bclass: 'help', onpress: bm_action},
					],										
					striped: true,
					nowrap: false,			 									    				
    				height: height,
    				title: 'YaCy Bookmarks: ' + HTMLenc(qtag)										    				
    			});    			
			}
		}); //close $.ajax(
	});
	function bm_action(com,grid) {
		if (com=='XBEL') {
			window.document.location.href = '/xml/bookmarks/xbel/xbel.xml';
		}
		else if (com=='RSS') {
			window.document.location.href = '/Bookmarks.rss';
		}
		else if (com=='XML') {
			window.document.location.href = '/xml/bookmarks/posts/all.xml';
		}
		else if (com=='Delete') {
			confirm('Delete ' + $('.trSelected',grid).length + ' bookmark(s)?')				
			$('.trSelected',grid).each(function(){
				var url = "/xml/bookmarks/posts/delete_p.xml?login=&urlhash="+$(this).find('td :first').text();					
				$.ajax({
					type: 'POST',
					url: url,			
					dataType: 'xml'						
				}); // close $.ajax(					
			}); //close each(
			loadFolders();
			loadTagCloud();
			$tabs.tabs("load", 3);	
		}
		else if (com=='Bookmark') {			
			$('#bmaddform').resetForm();
			$("#bm_url").blur(function() { 
				var url = $("input[@name='bm_url']").getValue();
				$.ajax({
					type: "GET",
					url: "/xml/util/getpageinfo_p.xml?url="+url,			
					dataType: "xml",
					success: function(xml) {
						var title = $(xml).find('title').text();
						$("textarea[@name='bm_title']").setValue(title);
						var desc = $(xml).find('desc').text();					
						$("textarea[@name='bm_desc']").setValue(desc);					
						tags = "";
						$(xml).find('tag').each(function(){
							tags = tags + "," + $(this).attr('name');
						});
						$("input[@name='bm_tags']").setValue(tags);									
					}					
				});
			});						
			$("#bmadd").dialog('open');
		} 
		else if (com=='Edit') {
			if ($('.trSelected',grid).length > 1) {
				alert("Edit of more than one selected bookmark is currently not supportet!");
				return false;
			}
			$("input[@name='bm_url']").setValue($('.trSelected',grid).find('.url').text());
            $("textarea[@name='bm_title']").setValue($('.trSelected',grid).find('h3.linktitle').text().replace(/^\s+/g,""));
            $("textarea[@name='bm_desc']").setValue($('.trSelected',grid).find('p.desc').text().replace(/^\s+/g,""));            		
            $("input[@name='bm_tags']").setValue($('.trSelected',grid).find('td.tags').text());            
            // $("input[@name='bm_path']").setValue($('.trSelected',grid).find('.path').text());
            $("select[@name='bm_public']").setValue($('.trSelected',grid).find('img').attr('alt'));
            $("#bmadd").dialog('open'); 
		}		
	}
  //]]>
</script>

<!-- Display Bookmarks Table -->		
<table id="ymarks" summary="YaCy Bookmarks">
	<tbody>		
	</tbody>
</table>






